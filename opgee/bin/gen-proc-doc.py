#
# Generate stub documentation for each process class by reading the processes/__init__.py file to
# find all the built-in Process subclasses. A documentation stub is written out for each subclass.
# All class and method documentation should be located in the Process' .py file.
#
import os
import re

template = """.. DO NOT EDIT THIS FILE. It is generated by the script bin/gen-proc-doc.py. Edit the process' .py file instead.

{classname} Process
============================================================

.. automodule:: opgee.processes.{filename}
   :members:

"""


def main():
    doc_dir = os.path.expanduser("~/repos/OPGEEv4/docs/source/processes")
    proc_dir = os.path.expanduser("~/repos/OPGEEv4/opgee/processes")

    with open(f"{proc_dir}/__init__.py") as f:
        imports = [line.strip() for line in f.readlines() if line and not line.startswith("from .process_for_test")]

    matches = [(m.group(1), m.group(2)) for m in [re.match(r"from \.(.+) import (.+)\s*", s) for s in imports]]

    for filename, classname in matches:
        with open(f"{doc_dir}/{classname}.rst", "w") as f:
            text = template.format(classname=classname, filename=filename)
            f.write(text)


main()
